# ğŸ“‚ test_2d_channel_flow_fluid_shell åŠŸèƒ½-ä»£ç æ˜ å°„æŠ¥å‘Š

## ğŸ—ï¸ é¡¹ç›®æ¦‚è§ˆ
- **æŠ€æœ¯æ ˆ**: C++11/14, SPHinXsys (å…‰æ»‘ç²’å­æµä½“åŠ¨åŠ›å­¦åº“), Google Test
- **æ¶æ„æ¨¡å¼**: è¿‡ç¨‹åŒ–/åŸºäºæ¨¡å— (å®šä¹‰ç‰©ç†ä½“ã€ææ–™ã€ç²’å­ç”Ÿæˆå™¨ã€æ•°å€¼ç®—æ³•å’Œæ•°æ®IO)
- **çŠ¶æ€ç®¡ç†**: SPHinXsys å†…éƒ¨ç²’å­æ•°æ®ç»“æ„
- **æ ·å¼æ–¹æ¡ˆ**: N/A (C++ç§‘å­¦è®¡ç®—ä»£ç )
- **æ„å»ºå·¥å…·**: `build.bat` (æ¨æµ‹ä¸ºWindowsæ‰¹å¤„ç†è„šæœ¬)
- **åŒ…ç®¡ç†**: N/A (ä½¿ç”¨ç³»ç»Ÿæˆ–å¤–éƒ¨åº“é“¾æ¥)

## ğŸ“Š åŠŸèƒ½æ¨¡å—ç»Ÿè®¡
- **ä¸»æ¨¡æ‹Ÿæ–‡ä»¶**: 1 ä¸ª ([`channel_flow_shell.cpp`](channel_flow_shell.cpp:1))
- **å‡ ä½•å®šä¹‰ç±»**: 1 ä¸ª ([`WaterBlock`](channel_flow_shell.cpp:28))
- **ç²’å­ç”Ÿæˆå™¨**: 1 ä¸ª ([`ParticleGenerator<SurfaceParticles, WallBoundary>`](channel_flow_shell.cpp:41))
- **è¾¹ç•Œæ¡ä»¶ç»“æ„ä½“**: 1 ä¸ª ([`InflowVelocity`](channel_flow_shell.cpp:77))
- **GTestæµ‹è¯•**: 1 ä¸ª ([`TEST(channel_flow_shell, thickness_10x)`](channel_flow_shell.cpp:365))

## ğŸ—‚ï¸ ç›®å½•ç»“æ„æ¦‚è§ˆ
```
[é¡¹ç›®æ ¹ç›®å½•]/
â”œâ”€â”€ channel_flow_shell.cpp  <- ä¸»æ¨¡æ‹Ÿé€»è¾‘
â”œâ”€â”€ build.bat               <- æ„å»ºè„šæœ¬
â”œâ”€â”€ visualize_velocity_field.m <- MATLABå¯è§†åŒ–è„šæœ¬
â”œâ”€â”€ input/                  <- æ½œåœ¨çš„è¾“å…¥æ–‡ä»¶ç›®å½•
â”œâ”€â”€ output/                 <- æ¨¡æ‹Ÿç»“æœè¾“å‡ºç›®å½•
â””â”€â”€ output_backup/          <- å†å²æ¨¡æ‹Ÿç»“æœ
```

---

## ğŸ¯ åŠŸèƒ½æ˜ å°„è¡¨

### é…ç½® - å…¨å±€ç‰©ç†å‚æ•° (æµä½“ç‰¹æ€§)

**ğŸ”¤ ç”¨æˆ·æè¿°æ–¹å¼**:
- ä¸»è¦: "æµä½“å¯†åº¦", "ç²˜åº¦", "é›·è¯ºæ•°", "å£°é€Ÿ", "ç‰¹å¾é€Ÿåº¦"
- åˆ«å: "ç‰©ç†å¸¸æ•°", "æµä½“å±æ€§", "æ¨¡æ‹Ÿè¾“å…¥å‚æ•°"

**ğŸ“ ä»£ç ä½ç½®**:
- ä¸»æ–‡ä»¶: [`channel_flow_shell.cpp`](channel_flow_shell.cpp:18) (å®šä¹‰ `rho0_f`, `U_f`, `c_f`, `Re`, `mu_f`)
- é€»è¾‘: [`channel_flow_shell.cpp`](channel_flow_shell.cpp:169) (åœ¨ `water_block` ä¸Šå®šä¹‰ææ–™å±æ€§)

**ğŸ¨ è§†è§‰æ ‡è¯†**:
- å¤–è§‚: N/A (åå°é…ç½®)
- æ–‡æœ¬: N/A

**âš¡ ä¿®æ”¹æŒ‡å¼•**:
- ä¿®æ”¹æµä½“å¯†åº¦: ç¼–è¾‘ [`channel_flow_shell.cpp:18`](channel_flow_shell.cpp:18) (`rho0_f`)
- ä¿®æ”¹é›·è¯ºæ•°: ç¼–è¾‘ [`channel_flow_shell.cpp:21`](channel_flow_shell.cpp:21) (`Re`)
- ä¿®æ”¹ç²˜æ€§ç³»æ•°: ç¼–è¾‘ [`channel_flow_shell.cpp:22`](channel_flow_shell.cpp:22) (`mu_f`)

---

### å‡ ä½• - æ¨¡æ‹ŸåŒºåŸŸå°ºå¯¸å’Œæµä½“å½¢çŠ¶

**ğŸ”¤ ç”¨æˆ·æè¿°æ–¹å¼**:
- ä¸»è¦: "é€šé“é•¿åº¦", "é€šé“é«˜åº¦", "æ¨¡æ‹ŸåŒºåŸŸå¤§å°", "æµä½“åŒºåŸŸå½¢çŠ¶"
- åˆ«å: "DL", "DH", "å‡ ä½•å‚æ•°", "è®¡ç®—åŸŸ"

**ğŸ“ ä»£ç ä½ç½®**:
- å°ºå¯¸å®šä¹‰: [`channel_flow_shell.cpp`](channel_flow_shell.cpp:13) (å®šä¹‰ `DL`, `DH`)
- å½¢çŠ¶åˆ›å»º: [`channel_flow_shell.cpp`](channel_flow_shell.cpp:147) (Lambdaå‡½æ•° `createWaterBlockShape`)
- åŸŸè¾¹ç•Œ: [`channel_flow_shell.cpp`](channel_flow_shell.cpp:142) (å®šä¹‰ `system_domain_bounds`)

**ğŸ¨ è§†è§‰æ ‡è¯†**:
- å¤–è§‚: N/A (åå°é…ç½®)
- æ–‡æœ¬: N/A

**âš¡ ä¿®æ”¹æŒ‡å¼•**:
- ä¿®æ”¹é€šé“é•¿åº¦/é«˜åº¦: ç¼–è¾‘ [`channel_flow_shell.cpp:13`](channel_flow_shell.cpp:13) å’Œ [`channel_flow_shell.cpp:14`](channel_flow_shell.cpp:14)
- ä¿®æ”¹æµä½“å—çš„å‡ ä½•åæ ‡: ç¼–è¾‘ [`channel_flow_shell.cpp:151-155`](channel_flow_shell.cpp:151)

---

### è¾¹ç•Œæ¡ä»¶ - æŠ›ç‰©çº¿æµå…¥é€Ÿåº¦

**ğŸ”¤ ç”¨æˆ·æè¿°æ–¹å¼**:
- ä¸»è¦: "å…¥å£é€Ÿåº¦æ¡ä»¶", "æŠ›ç‰©çº¿æµå…¥", "InflowVelocity", "åŠ é€Ÿæ—¶é—´"
- åˆ«å: "å…¥å£è¾¹ç•Œ", "é€Ÿåº¦å‰–é¢"

**ğŸ“ ä»£ç ä½ç½®**:
- é€Ÿåº¦å‡½æ•°å®šä¹‰: [`channel_flow_shell.cpp`](channel_flow_shell.cpp:89) (`operator()`)
- è¾¹ç•Œæ¡ä»¶åº”ç”¨: [`channel_flow_shell.cpp`](channel_flow_shell.cpp:217) (å®šä¹‰ `inflow_buffer` å’Œ `parabolic_inflow`)
- åŠ é€Ÿæ—¶é—´: [`channel_flow_shell.cpp`](channel_flow_shell.cpp:85) (`t_ref_ = 2.0`)

**ğŸ¨ è§†è§‰æ ‡è¯†**:
- å¤–è§‚: N/A (åå°ç®—æ³•)
- æ–‡æœ¬: N/A

**âš¡ ä¿®æ”¹æŒ‡å¼•**:
- ä¿®æ”¹æµå…¥é€Ÿåº¦é…ç½®æ–‡ä»¶: ç¼–è¾‘ [`channel_flow_shell.cpp`](channel_flow_shell.cpp:77) ä¸­çš„ `InflowVelocity` ç»“æ„ä½“
- ä¿®æ”¹é€Ÿåº¦æ›²çº¿é€»è¾‘: ç¼–è¾‘ [`channel_flow_shell.cpp:92`](channel_flow_shell.cpp:92)

---

### è¾¹ç•Œæ¡ä»¶ - å‘¨æœŸæ€§è¾¹ç•Œ

**ğŸ”¤ ç”¨æˆ·æè¿°æ–¹å¼**:
- ä¸»è¦: "å‘¨æœŸæ€§è¾¹ç•Œæ¡ä»¶", "Xæ–¹å‘å‘¨æœŸæ€§", "PeriodicCondition"
- åˆ«å: "å¾ªç¯è¾¹ç•Œ", "å‘¨æœŸæ¡ä»¶"

**ğŸ“ ä»£ç ä½ç½®**:
- å‘¨æœŸè½´å®šä¹‰: [`channel_flow_shell.cpp`](channel_flow_shell.cpp:221) (`PeriodicAlongAxis periodic_along_x`)
- å‘¨æœŸæ¡ä»¶å¯¹è±¡: [`channel_flow_shell.cpp`](channel_flow_shell.cpp:222) (`PeriodicConditionUsingCellLinkedList periodic_condition`)

**âš¡ ä¿®æ”¹æŒ‡å¼•**:
- ç¦ç”¨æˆ–ä¿®æ”¹å‘¨æœŸè½´: ç¼–è¾‘ [`channel_flow_shell.cpp:221`](channel_flow_shell.cpp:221)

---

### æ•°æ®è¾“å‡º - VTPæ–‡ä»¶çŠ¶æ€è®°å½•

**ğŸ”¤ ç”¨æˆ·æè¿°æ–¹å¼**:
- ä¸»è¦: "VTPæ–‡ä»¶è¾“å‡º", "ä½“çŠ¶æ€è®°å½•", "è¾“å‡ºæµä½“å½¢çŠ¶", "å£é¢æ›²ç‡è¾“å‡º"
- åˆ«å: "å¯è§†åŒ–æ•°æ®", "Paraviewæ–‡ä»¶"

**ğŸ“ ä»£ç ä½ç½®**:
- VTPè®°å½•å™¨: [`channel_flow_shell.cpp`](channel_flow_shell.cpp:232) (`BodyStatesRecordingToVtp write_real_body_states`)
- è¾“å‡ºå˜é‡æ·»åŠ : [`channel_flow_shell.cpp`](channel_flow_shell.cpp:233) (æ·»åŠ  `Average1stPrincipleCurvature`)
- è¾“å‡ºæ‰§è¡Œ: [`channel_flow_shell.cpp`](channel_flow_shell.cpp:267), [`channel_flow_shell.cpp:322`](channel_flow_shell.cpp:322)

**âš¡ ä¿®æ”¹æŒ‡å¼•**:
- è°ƒæ•´è¾“å‡ºé¢‘ç‡: ä¿®æ”¹ [`channel_flow_shell.cpp:258`](channel_flow_shell.cpp:258) (`output_interval`)
- æ›´æ”¹è¾“å‡ºè·¯å¾„: éœ€è¦ä¿®æ”¹ SPHinXsys åº“çš„é…ç½®æˆ–åœ¨ä¸»å‡½æ•°ä¸­æ·»åŠ è·¯å¾„å‚æ•°ï¼ˆå½“å‰ä»£ç ä¸­æœªæš´éœ²ï¼‰
- å¢åŠ è¦è®°å½•çš„å˜é‡: åœ¨ [`channel_flow_shell.cpp:233`](channel_flow_shell.cpp:233) é™„è¿‘æ·»åŠ æ–°çš„ `addToWrite` è°ƒç”¨

---

### æ•°æ®è¾“å‡º - è§‚å¯Ÿç‚¹é€Ÿåº¦è®°å½•

**ğŸ”¤ ç”¨æˆ·æè¿°æ–¹å¼**:
- ä¸»è¦: "è§‚å¯Ÿç‚¹é€Ÿåº¦", "æ•°æ®è§‚æµ‹", "CSVè¾“å‡º", "FluidAxialObserver"
- åˆ«å: "è½´å‘é€Ÿåº¦æ›²çº¿", "å¾„å‘é€Ÿåº¦æ›²çº¿", "æ•°æ®æ¢é’ˆ"

**ğŸ“ ä»£ç ä½ç½®**:
- è½´å‘è§‚å¯Ÿç‚¹å®šä¹‰: [`channel_flow_shell.cpp`](channel_flow_shell.cpp:101) (`createFluidAxialObservationPoints`)
- å¾„å‘è§‚å¯Ÿç‚¹å®šä¹‰: [`channel_flow_shell.cpp`](channel_flow_shell.cpp:118) (`createFluidRadialObservationPoints`)
- è®°å½•å™¨: [`channel_flow_shell.cpp`](channel_flow_shell.cpp:234) (`ObservedQuantityRecording`)
- è¾“å‡ºæ‰§è¡Œ: [`channel_flow_shell.cpp:325`](channel_flow_shell.cpp:325) å’Œ [`channel_flow_shell.cpp:326`](channel_flow_shell.cpp:326)

**âš¡ ä¿®æ”¹æŒ‡å¼•**:
- ä¿®æ”¹è½´å‘è§‚å¯Ÿç‚¹ä½ç½®: ç¼–è¾‘ [`channel_flow_shell.cpp:108`](channel_flow_shell.cpp:108) (`y_position`) æˆ– [`channel_flow_shell.cpp:106`](channel_flow_shell.cpp:106) (`range_of_measure`)
- ä¿®æ”¹å¾„å‘è§‚å¯Ÿç‚¹ä½ç½®: ç¼–è¾‘ [`channel_flow_shell.cpp:125`](channel_flow_shell.cpp:125) (`x_position`)
- è°ƒæ•´è¾“å‡ºé¢‘ç‡: ä¸ VTP æ–‡ä»¶è¾“å‡ºé¢‘ç‡ä¸€è‡´ï¼Œä¿®æ”¹ [`channel_flow_shell.cpp:258`](channel_flow_shell.cpp:258) (`output_interval`)

---

### æ¨¡æ‹Ÿæ‰§è¡Œ - æ—¶é—´æ­¥é•¿å’Œä¸»å¾ªç¯

**ğŸ”¤ ç”¨æˆ·æè¿°æ–¹å¼**:
- ä¸»è¦: "æ¨¡æ‹Ÿè¿è¡Œæ—¶é—´", "æ—¶é—´æ­¥é•¿è®¡ç®—", "ä¸»å¾ªç¯", "è¿­ä»£æ¬¡æ•°"
- åˆ«å: "End Time", "Simulation Loop", "æ—¶é—´ç§¯åˆ†"

**ğŸ“ ä»£ç ä½ç½®**:
- ç»“æŸæ—¶é—´: [`channel_flow_shell.cpp:257`](channel_flow_shell.cpp:257) (`end_time = 10.0`)
- ä¸»å¾ªç¯: [`channel_flow_shell.cpp`](channel_flow_shell.cpp:271) (`while (physical_time < end_time)`)
- æ—¶é—´æ­¥é•¿è®¡ç®—: [`channel_flow_shell.cpp:277`](channel_flow_shell.cpp:277) (`get_fluid_advection_time_step_size.exec()`)

**âš¡ ä¿®æ”¹æŒ‡å¼•**:
- å»¶é•¿æˆ–ç¼©çŸ­æ¨¡æ‹Ÿæ—¶é—´: ç¼–è¾‘ [`channel_flow_shell.cpp:257`](channel_flow_shell.cpp:257)
- è°ƒæ•´å±å¹•è¾“å‡ºé¢‘ç‡: ç¼–è¾‘ [`channel_flow_shell.cpp:256`](channel_flow_shell.cpp:256) (`screen_output_interval`)

---

### ç¼–è¯‘å’Œæµ‹è¯• - GTestæ‰§è¡Œ

**ğŸ”¤ ç”¨æˆ·æè¿°æ–¹å¼**:
- ä¸»è¦: "GTestæµ‹è¯•", "è¿è¡Œæµ‹è¯•", "CIæµ‹è¯•", "ç»“æœéªŒè¯"
- åˆ«å: "å•å…ƒæµ‹è¯•", "EXPECT_NEAR", "éªŒè¯é€»è¾‘"

**ğŸ“ ä»£ç ä½ç½®**:
- æµ‹è¯•å®šä¹‰: [`channel_flow_shell.cpp`](channel_flow_shell.cpp:365) (`TEST(channel_flow_shell, thickness_10x)`)
- æµ‹è¯•é€»è¾‘: [`channel_flow_shell.cpp:340-362`](channel_flow_shell.cpp:340) (å°†æ¨¡æ‹Ÿç»“æœä¸è§£æè§£è¿›è¡Œæ¯”è¾ƒ)
- ä¸»å‡½æ•°: [`channel_flow_shell.cpp`](channel_flow_shell.cpp:375) (è°ƒç”¨ `RUN_ALL_TESTS()`)

**âš¡ ä¿®æ”¹æŒ‡å¼•**:
- ä¿®æ”¹æµ‹è¯•ç²¾åº¦: ç¼–è¾‘ [`channel_flow_shell.cpp:353`](channel_flow_shell.cpp:353) å’Œ [`channel_flow_shell.cpp:361`](channel_flow_shell.cpp:361) ä¸­çš„å®¹å·®å€¼ (`U_f * 5e-2`)
- æ·»åŠ æ–°çš„æµ‹è¯•ç”¨ä¾‹: åœ¨ [`channel_flow_shell.cpp:365`](channel_flow_shell.cpp:365) é™„è¿‘æ·»åŠ æ–°çš„ `TEST` å—

---

## ğŸ“š æ·±åº¦æŠ€æœ¯æ–‡æ¡£

### Verletæ—¶é—´ç§¯åˆ†æ–¹æ¡ˆ

**ç›¸å…³æ–‡æ¡£**:
- [`Verletæ—¶é—´ç§¯åˆ†ä¸å¯†åº¦æ›´æ–°è¯¦è§£.md`](Verletæ—¶é—´ç§¯åˆ†ä¸å¯†åº¦æ›´æ–°è¯¦è§£.md) - å®Œæ•´çš„æ—¶é—´ç§¯åˆ†æ–¹æ¡ˆè§£æ
- [`å‰ååŠæ­¥å¯¹æ¯”è¯¦è§£.md`](å‰ååŠæ­¥å¯¹æ¯”è¯¦è§£.md) - Integration1stHalf vs Integration2ndHalfè¯¦ç»†å¯¹æ¯”

**æ ¸å¿ƒä»£ç ä½ç½®**ï¼ˆSPHinXsysæºç ï¼‰:
- Integration1stHalf: `src/shared/particle_dynamics/fluid_dynamics/fluid_integration.hpp:64-80`
- Integration2ndHalf: `src/shared/particle_dynamics/fluid_dynamics/fluid_integration.hpp:179-196`
- é»æ›¼æ±‚è§£å™¨: `src/shared/physical_closure/materials/riemann_solver.h:92-99`

**åœ¨Channel Flowä¸­çš„ä½¿ç”¨**:
```cpp
// channel_flow_shell.cpp:195-196
Dynamics1Level<fluid_dynamics::Integration1stHalfWithWallRiemann>
    pressure_relaxation(water_block_inner, water_block_contact);

Dynamics1Level<fluid_dynamics::Integration2ndHalfWithWallNoRiemann>
    density_relaxation(water_block_inner, water_block_contact);
```

**å…³é”®æŠ€æœ¯ç‚¹**:
1. **å‰åŠæ­¥ï¼ˆ1st Halfï¼‰**:
   - æ›´æ–°é€Ÿåº¦ï¼š`v^(n+1/2) = v^n + F/m Ã— dt`
   - æ›´æ–°å¯†åº¦ï¼ˆé»æ›¼è€—æ•£ï¼‰ï¼š`drho_dt_ = Ï Î£ [(p_i - p_j)/(Ïâ‚€câ‚€)] âˆ‡W V`
   - æºç ä½ç½®ï¼š`fluid_integration.hpp:78-79`

2. **ååŠæ­¥ï¼ˆ2nd Halfï¼‰**:
   - æ›´æ–°å¯†åº¦ï¼ˆè¿ç»­æ€§æ–¹ç¨‹ï¼‰ï¼š`drho_dt_ += Ï Î£ (v_i - v_j)Â·e_ij âˆ‡W V`
   - ä¼ è¾“é€Ÿåº¦ä¿®æ­£ï¼š`force = Î£ [Ïâ‚€câ‚€ u_jump] âˆ‡W V e_ij`ï¼ˆNoRiemannç‰ˆæœ¬æ­¤é¡¹ä¸º0ï¼‰
   - æºç ä½ç½®ï¼š`fluid_integration.hpp:191-195`

3. **å®Œæ•´å¯†åº¦æ¼”åŒ–**:
   ```
   Ï^(n+1) = Ï^n + [é»æ›¼è€—æ•£é¡¹] Ã— dt/2    (å‰åŠæ­¥)
                 + [è¿ç»­æ€§æ–¹ç¨‹é¡¹] Ã— dt/2   (ååŠæ­¥)
   ```

**ä¿®æ”¹æŒ‡å¼•**:
- åˆ‡æ¢ä¸ºNoRiemann: å°† `Integration1stHalfWithWallRiemann` æ”¹ä¸º `Integration1stHalfWithWallNoRiemann`
- å¯ç”¨2nd Halfé»æ›¼: å°† `Integration2ndHalfWithWallNoRiemann` æ”¹ä¸º `Integration2ndHalfWithWallRiemann`

**æ³¨æ„äº‹é¡¹**:
- NoRiemann **ä¸æ„å‘³ç€æ— å¯†åº¦æ›´æ–°**ï¼Œè¿ç»­æ€§æ–¹ç¨‹ä»ç„¶å­˜åœ¨
- 2nd Halfçš„å¯†åº¦æ›´æ–°æ˜¯**ç´¯åŠ **åˆ°1st Halfçš„ç»“æœä¸Šï¼ˆä½¿ç”¨`+=`ï¼‰
- ä½é€ŸæµåŠ¨ï¼ˆå¦‚æœ¬ä¾‹Re=100ï¼‰ä½¿ç”¨1st Half Riemann + 2nd Half NoRiemannæ˜¯ç¨³å®šæ€§å’Œæ•ˆç‡çš„å¹³è¡¡