# 通用代码开发工作流与规范

本工作流旨在为常规软件/脚本开发提供一套可重复的步骤与文档格式。无论项目类型（服务端、桌面应用、数据脚本或科研代码），均可据此执行并适度调整。

---

## 1. 启动阶段

- **需求梳理**
  - 建立 `docs/requirements.md`（或在仓库根目录的 `README` 中添加“需求”段）。
  - 列出用户场景、核心功能、约束条件，以及验收标准。
  - 使用结构化格式：
    ```markdown
    ## 业务目标
    - …

    ## 功能需求
    1. 功能描述：验收条件。

    ## 非功能需求
    - 性能：…
    - 安全：…
    ```
- **任务拆解**
  - 创建 `TODO.md` 或使用 Issue/Project 工具，将需求拆分成可执行的任务，使用复选框表示进度。
  - 每个任务最好包含：目标、负责人、预估工时、依赖关系。

---

## 2. 设计阶段

- **系统/模块设计**
  - 编写 `docs/design.md`，内容包括：
    - 系统架构图或组件图
    - 数据流、控制流解释
    - 技术选型与替代方案比较
    - 接口设计（输入/输出/异常）
  - Markdown 示例：
    ```markdown
    ## 模块结构
    - ModuleA：职责...

    ## 数据流
    1. 输入 -> 校验 -> 存储

    ## 接口定义
    ### POST /api/foo
    - Request：...
    - Response：...
    ```
- **编码规范约定**
  - 建议建立 `CONTRIBUTING.md`，包含：
    - 代码风格（缩进、命名、注释惯例）
    - 分支策略（如 Git Flow / trunk-based）
    - 提交规范（Commit message、PR 模板）

---

## 3. 实现阶段

- **开发步骤**
  1. 从 `main`/`develop` 建立功能分支。
  2. 依据 `TODO` 中的任务实现功能，遵循规范：
     - 代码分层（组件内聚，接口清晰）
     - 注释规范（解释“为什么”，而非“做了什么”）
     - 及时运行单元测试 / lint。
  3. 编写或更新测试（单元、集成、端到端），放置于 `tests/` 目录。
  4. 若涉及配置/脚本，更新 `README` 的“运行方式”或“环境配置”。
- **提交信息**（示例）
  ```text
  feat(auth): 支持 OAuth2 登录

  - 新增 OAuthClient 模块
  - 补充登录流程测试
  ```

---

## 4. 代码审查与合并

- **自检清单**
  - 需求是否全部完成？
  - 是否有遗漏的测试/文档更新？
  - `git status` 是否干净？没有无关更改或临时文件。
- **发起 PR / Merge Request**
  - 附带摘要、测试方式、影响范围、风险点。
  - 若变动较大，提供截图或日志。
- **代码评审**
  - 点评聚焦在正确性、可维护性、安全性、性能。
  - 标注“必须修改”“建议修改”“疑问”等级别。
- **合并策略**
  - Squash 压缩历史或保留关键 commit，视团队习惯而定。

---

## 5. 测试与部署

- **自动化测试**：配置 CI（GitHub Actions、GitLab CI 等）运行 lint、构建、测试。
- **发布流程**
  - 准备 `CHANGELOG.md`，按版本记录新增/变更/修复。
  - 按语义化版本管理（0.1.0、1.0.0、1.0.1 等）。
  - 打包、发布或部署到相应环境，并执行 Smoke Test。

---

## 6. 文档与知识沉淀

- **用户文档**：更新 `README.md` 或 `docs/usage.md`，说明安装、配置、运行。
- **技术文档**：补充 `docs/architecture.md`（架构）、`docs/troubleshooting.md`（问题排查）。
- **经验记录**：在 `docs/postmortem/` 中记录复盘（如发生异常、性能瓶颈）。

---

## 7. 维护阶段

- **监控与反馈**：部署日志、性能指标、用户反馈渠道。
- **缺陷处理流程**：发现 bug → 建议建立 Issue → 关联修复分支 → 回归测试 → 合并。
- **周期性回顾**：根据迭代安排，复查 TODO、技术债务、优化机会。

---

## 参考格式与目录结构建议

```
project-root/
├── src/                 # 源码
├── tests/               # 测试
├── docs/
│   ├── requirements.md
│   ├── design.md
│   ├── architecture.md
│   ├── troubleshooting.md
│   └── postmortem/
├── README.md
├── TODO.md
├── CONTRIBUTING.md
├── CHANGELOG.md
└── scripts/             # 构建或部署脚本
```

- Markdown 风格：使用 `#`、`##`、`###` 层级标题；代码示例用 ```语言 块；列表使用 `-` 或 `1.`。
- Commit / PR 模板可放在 `.github/`、`.gitlab/` 目录。

---

按照本工作流，可以在不同类型的开发项目中保持统一的规划、实现、测试、交付与维护节奏，从而提高协作效率和质量。*** End Patch
