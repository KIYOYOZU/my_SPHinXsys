# 📂 SPHinXsys 功能-代码映射报告

## 🏗️ 项目概览
- **技术栈**: C++ (SPHinXsys Library), MATLAB
- **架构模式**: 科学计算模拟，数据预处理与可视化
- **状态管理**: SPHinXsys 内部粒子系统状态管理，MATLAB 结构体进行数据传递
- **样式方案**: MATLAB 绘图函数配置
- **构建工具**: CMake (通过 `CMakeLists.txt`), `build.bat` (Windows 批处理脚本)
- **包管理**: N/A (C++ 依赖 SPHinXsys 库，MATLAB 脚本独立运行)

## 📊 功能模块统计
- **C++ 模拟核心**: `poiseuille_flow_shell.cpp` (1 个主要模拟文件)
- **MATLAB 数据处理**: `preprocess_data.m` (1 个数据预处理脚本)
- **MATLAB 数据可视化**: `visualize_flow.m` (1 个数据可视化脚本)
- **配置文件**: `CMakeLists.txt`, `build.bat`
- **文档**: `README.md`, `SPHinXsys_Workflow_Cookbook.md`
- **输出数据**: `output/` 目录下的 `.vtp` 和 `.dat` 文件

## 🗂️ 目录结构概览
```
[项目根目录]/
├── build.bat
├── CMakeLists.txt
├── flow_data.mat
├── poiseuille_flow_shell.cpp
├── preprocess_data.m
├── README.md
├── SPHinXsys_Workflow_Cookbook.md
├── visualize_flow.m
├── input/
└── output/
    ├── fluid_observer_axial_Velocity.dat
    ├── fluid_observer_radial_Velocity.dat
    └── ... (其他 .vtp 文件)
```

---

## 🎯 功能映射表

### 模拟核心 - 3D Poiseuille 流模拟

**🔤 用户描述方式**:
- 主要: "Poiseuille 流模拟", "流体与壳体相互作用模拟", "SPH 流体模拟"
- 别名: "流体计算", "管道流模拟", "壳体耦合"

**📍 代码位置**:
- 主文件: [`poiseuille_flow_shell.cpp`](poiseuille_flow_shell.cpp)
- 核心函数: `poiseuille_flow(const Real resolution_ref, const Real resolution_shell, const Real shell_thickness)` [`poiseuille_flow_shell.cpp:130`](poiseuille_flow_shell.cpp:130)

**🎨 视觉标识**:
- 输出文件: `output/WaterBody_*.vtp`, `output/Shell_*.vtp` (VTK 格式的粒子数据)

**⚡ 修改指引**:
- 修改模拟参数 (如流体半径、长度、雷诺数): 编辑 [`poiseuille_flow_shell.cpp:13-26`](poiseuille_flow_shell.cpp:13-26) 的 `const Real` 定义。
- 修改粒子分辨率: 编辑 `poiseuille_flow` 函数调用处的 `resolution_ref`, `resolution_shell` 参数，例如 [`poiseuille_flow_shell.cpp:403-406`](poiseuille_flow_shell.cpp:403-406) 的 `TEST` 块。
- 修改模拟时间或输出频率: 编辑 [`poiseuille_flow_shell.cpp:269-271`](poiseuille_flow_shell.cpp:269-271) 的 `end_time`, `Output_Time`。
- 修改流体或壳体材料属性: 编辑 [`poiseuille_flow_shell.cpp:176`](poiseuille_flow_shell.cpp:176) (流体) 或 [`poiseuille_flow_shell.cpp:182`](poiseuille_flow_shell.cpp:182) (壳体) 的 `defineClosure` 或 `defineMaterial`。
- 修改入口速度分布: 编辑 [`SPH::InflowVelocity::operator()`](poiseuille_flow_shell.cpp:115) 函数。

---

### 数据处理 - 模拟结果预处理

**🔤 用户描述方式**:
- 主要: "处理模拟数据", "VTP 文件解析", "生成 MATLAB 数据文件"
- 别名: "数据转换", "数据清洗", "流数据预处理"

**📍 代码位置**:
- 主文件: [`preprocess_data.m`](preprocess_data.m)
- 核心功能: 从 VTP 文件提取时间、位置和速度数据，并保存为 `flow_data.mat`。

**🎨 视觉标识**:
- 输入文件: `output/*.vtp` (SPHinXsys 模拟输出)
- 输出文件: `flow_data.mat` (MATLAB 数据文件)

**⚡ 修改指引**:
- 修改输出目录或输出文件名: 编辑 [`preprocess_data.m:9-10`](preprocess_data.m:9-10) 的 `output_dir`, `output_mat_file`。
- 修改时间缩放因子: 编辑 [`preprocess_data.m:11`](preprocess_data.m:11) 的 `time_scaling_factor`。
- 修改 VTP 文件解析逻辑: 编辑 [`preprocess_data.m:41-64`](preprocess_data.m:41-64) 的正则表达式和 `sscanf` 调用。

---

### 数据可视化 - 流体动画与剖面图

**🔤 用户描述方式**:
- 主要: "可视化流体模拟", "3D 粒子动画", "速度剖面图"
- 别名: "流场显示", "结果动画", "MATLAB 可视化"

**📍 代码位置**:
- 主文件: [`visualize_flow.m`](visualize_flow.m)
- 核心功能: 加载 `flow_data.mat`，创建 3D 粒子动画和 2D 速度剖面图，并同步更新。

**🎨 视觉标识**:
- 输入文件: `flow_data.mat`
- 输出: MATLAB 图形窗口显示 3D 粒子动画和 2D 速度剖面图

**⚡ 修改指引**:
- 修改动画播放速度或粒子大小: 编辑 [`visualize_flow.m:12-13`](visualize_flow.m:12-13) 的 `animation_speed`, `marker_size`。
- 修改 3D 视图角度或轴限制: 编辑 [`visualize_flow.m:50`](visualize_flow.m:50) (view) 或 [`visualize_flow.m:77-79`](visualize_flow.m:77-79) (xlim, ylim, zlim)。
- 修改 2D 速度剖面图的显示范围: 编辑 [`visualize_flow.m:96-97`](visualize_flow.m:96-97) 的 `xlim`, `ylim`。
- 修改颜色映射: 编辑 [`visualize_flow.m:54`](visualize_flow.m:54) 的 `colormap`。
- 修改 3D 或 2D 绘图更新逻辑: 编辑 [`visualize_flow.m:104-120`](visualize_flow.m:104-120) 的动画循环部分。

---

### 构建系统 - 编译与项目配置

**🔤 用户描述方式**:
- 主要: "编译项目", "构建模拟程序"
- 别名: "CMake 配置", "Windows 构建脚本"

**📍 代码位置**:
- 主文件: [`CMakeLists.txt`](CMakeLists.txt) (CMake 构建配置)
- 脚本: [`build.bat`](build.bat) (Windows 构建批处理脚本)

**🎨 视觉标识**:
- 命令行输出: 编译过程中的信息
- 输出文件: 生成的可执行文件 (例如 `poiseuille_flow_shell.exe`)

**⚡ 修改指引**:
- 修改 CMake 构建选项: 编辑 [`CMakeLists.txt`](CMakeLists.txt) 中的 `cmake` 命令或变量。
- 修改 Windows 构建流程: 编辑 [`build.bat`](build.bat) 中的命令。

---

### 文档 - 项目说明与工作流

**🔤 用户描述方式**:
- 主要: "项目说明", "工作流指南"
- 别名: "README", "Cookbook", "使用说明"

**📍 代码位置**:
- 主要文件: [`README.md`](README.md), [`SPHinXsys_Workflow_Cookbook.md`](SPHinXsys_Workflow_Cookbook.md)

**🎨 视觉标识**:
- 文本内容: 纯文本或 Markdown 格式的说明文档

**⚡ 修改指引**:
- 修改项目概述或安装说明: 编辑 [`README.md`](README.md)。
- 修改 SPHinXsys 工作流相关指南: 编辑 [`SPHinXsys_Workflow_Cookbook.md`](SPHinXsys_Workflow_Cookbook.md)。